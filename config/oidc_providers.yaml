# ============================================================================
# OIDC Providers Configuration
# ============================================================================
# This file configures OpenID Connect (OIDC) Single Sign-On providers.
#
# Location: config/oidc_providers.yaml (root workspace folder)
# Format: YAML
# ============================================================================

# ============================================================================
# PROVIDER DEFINITIONS
# ============================================================================
# Define one or more OIDC identity providers (Keycloak, Azure AD, Okta, etc.)

providers:
  
  # ---------------------------------------------------------------------------
  # Example 1: Corporate Keycloak Instance
  # ---------------------------------------------------------------------------
  corporate:
    # Enable/disable this provider
    enabled: true
    
    # Backend Only Provider
    # If true, this provider is used only for backend-to-NiFi authentication
    # and will not be shown on the user login page
    backend: false
    
    # Display Settings (shown on login page)
    name: "Corporate SSO"
    description: "Sign in with your company account"
    icon: "building"        # Options: building, flask, users, shield, or leave empty
    display_order: 1        # Lower numbers appear first
    
    # OpenID Connect Configuration
    # For Keycloak: http(s)://{host}:{port}/realms/{realm}/.well-known/openid-configuration
    discovery_url: "https://keycloak:7443/realms/datenschleuder/.well-known/openid-configuration"
    
    # OAuth Client Credentials (from your OIDC provider)
    client_id: "datenschleuder"
    client_secret: "CH7BR2waXwfApVPjWE0bxBaMYFAxELnZ"
    
    # Optional: Override default redirect URI
    # Default is automatically constructed from backend URL + /auth/oidc/callback
    redirect_uri: "http://localhost:3000/login/callback"

    # Custom CA Certificate (for self-signed certificates)
    # Path can be absolute or relative to project root
    # Must be in PEM format - use config/certs/convert-cert.sh to convert other formats
    ca_cert_path: "config/certs/ca.cert.pem"
    
    # OAuth Scopes to Request
    scopes:
      - openid
      - profile
      - email
      - offline_access
    
    # Claim Mapping
    # Map OIDC token claims to user attributes
    claim_mappings:
      username: "preferred_username"  # Claim to use as username (required)
      email: "email"                   # Claim for email address
      name: "name"                     # Claim for display name
      groups: "groups"                 # Optional: for future role mapping
    
    # User Provisioning Settings
    auto_provision: true            # Automatically create users on first login
    default_role: "user"            # Role for new users: "user" or "admin"
    username_prefix: ""             # Optional: prefix to avoid conflicts
  

  nifi_backend:
    # MANDATORY FIELDS
    enabled: true
    
    # backend: Set to true to use this provider ONLY for backend authentication
    # When true, this provider will not appear on the user login page
    # Use this for machine-to-machine authentication (Client Credentials flow)
    backend: true

    # Display Settings (shown on login page)
    name: "NiPyAPI"
    description: "backend OIDC provider for NiFi backend authentication"

    # Discovery URL for backend authentication
    # For Keycloak: https://{host}:{port}/realms/{realm}/.well-known/openid-configuration
    discovery_url: "https://keycloak:7443/realms/oidc/.well-known/openid-configuration"
    
    # Client credentials for backend service account
    # Configure these in your OIDC provider:
    #   - Access Type: confidential
    #   - Service Accounts Enabled: ON
    #   - Standard Flow Enabled: OFF (not needed for backend)
    client_id: "oidc"
    client_secret: "hOpFglgyuFLdb5N2nq6ZwkVbLYclhXnA"
    
    # Redirect URI not needed for backend-only providers (Client Credentials flow)
    redirect_uri: "https://localhost:8443/nifi-api/access/oidc/callback"
    
    # OPTIONAL: Display settings (not shown to users but good for documentation)
    name: "NiFi Backend Service"
    description: "Backend authentication for NiFi instances (Client Credentials)"
    
    # Custom CA certificate if NiFi uses self-signed certificates
    ca_cert_path: "config/certs/nifi-ca.cert.pem"
    
    # Scopes for backend authentication
    # For Client Credentials flow, typically just openid
    scopes:
      - openid
    
    # Note: To use this provider, set OIDC_BACKEND_PROVIDER=nifi_backend in .env file

# ============================================================================
# GLOBAL OIDC SETTINGS
# ============================================================================
global:
  # Allow Traditional Login
  # true: Show both SSO and username/password login
  # false: Show only SSO provider buttons (SSO-only mode)
  allow_traditional_login: true
  
  # Session Timeout (minutes)
  # How long before OIDC user sessions expire
  session_timeout: 480
  
  # Auto-redirect to OIDC
  # If only one provider is enabled, automatically redirect to it
  auto_redirect_single_provider: false

# ============================================================================
# CONFIGURATION NOTES
# ============================================================================
#
# 1. PROVIDER SETUP:
#    - Create a new OIDC client in your identity provider
#    - Set client type to "confidential"
#    - Add Valid Redirect URIs matching your deployment
#    - Generate client_id and client_secret
#
# 2. DISCOVERY URL:
#    - Must point to the OpenID Connect discovery document
#    - Example: https://provider.com/.well-known/openid-configuration
#
# 3. CLAIM MAPPINGS:
#    - Standard claims: sub, preferred_username, email, name
#    - Custom claims depend on your provider configuration
#
# 4. SECURITY:
#    - Keep client_secret secure
#    - Use environment variables for sensitive values in production
#    - Rotate secrets regularly
